{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport StaticContainer from \"./StaticContainer\";\nimport { RootControllerChanges } from \"./RootController\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar _default = function (_Component) {\n  _inherits(_default, _Component);\n\n  var _super = _createSuper(_default);\n\n  function _default(props) {\n    var _this;\n\n    _classCallCheck(this, _default);\n\n    _this = _super.call(this, props);\n    _this.siblingsPool = [];\n    _this.updatedSiblings = new Set();\n    _this.unmounted = false;\n    _this.state = {\n      siblings: []\n    };\n    return _this;\n  }\n\n  _createClass(_default, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.props.controller.setCallback(function (id, change) {\n        setImmediate(function () {\n          return _this2.commitChange(id, change);\n        });\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.updatedSiblings.clear();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unmounted = true;\n    }\n  }, {\n    key: \"commitChange\",\n    value: function commitChange(id, _ref) {\n      var _this3 = this;\n\n      var change = _ref.change,\n          element = _ref.element,\n          updateCallback = _ref.updateCallback;\n\n      if (this.unmounted) {\n        return;\n      }\n\n      var siblings = Array.from(this.siblingsPool);\n      var index = siblings.findIndex(function (sibling) {\n        return sibling.id === id;\n      });\n\n      if (change === RootControllerChanges.Remove) {\n        if (index > -1) {\n          siblings.splice(index, 1);\n        } else {\n          this.invokeCallback(updateCallback);\n          return;\n        }\n      } else if (change === RootControllerChanges.Update) {\n        if (index > -1) {\n          siblings.splice(index, 1, {\n            element: element,\n            id: id\n          });\n          this.updatedSiblings.add(id);\n        } else {\n          this.invokeCallback(updateCallback);\n          return;\n        }\n      } else {\n        if (index > -1) {\n          siblings.splice(index, 1);\n        }\n\n        siblings.push({\n          element: element,\n          id: id\n        });\n        this.updatedSiblings.add(id);\n      }\n\n      this.siblingsPool = siblings;\n      this.setState({\n        siblings: siblings\n      }, function () {\n        return _this3.invokeCallback(updateCallback);\n      });\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(callback) {\n      if (callback) {\n        callback();\n      }\n    }\n  }, {\n    key: \"renderSiblings\",\n    value: function renderSiblings() {\n      var _this4 = this;\n\n      return this.state.siblings.map(function (_ref2) {\n        var id = _ref2.id,\n            element = _ref2.element;\n        return _jsx(StaticContainer, {\n          shouldUpdate: _this4.updatedSiblings.has(id),\n          children: _this4.wrapSibling(element)\n        }, \"root-sibling-\" + id);\n      });\n    }\n  }, {\n    key: \"wrapSibling\",\n    value: function wrapSibling(element) {\n      var renderSibling = this.props.renderSibling;\n\n      if (renderSibling) {\n        return renderSibling(element);\n      } else {\n        return element;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _jsxs(_Fragment, {\n        children: [this.props.children, this.renderSiblings()]\n      });\n    }\n  }]);\n\n  return _default;\n}(Component);\n\nexport { _default as default };","map":{"version":3,"sources":["../src/RootSiblings.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import React, { Component } from 'react';\nimport StaticContainer from './StaticContainer';\nimport { RootControllerChanges } from './RootController';\nexport default class extends Component {\n    constructor(props) {\n        super(props);\n        this.siblingsPool = [];\n        this.updatedSiblings = new Set();\n        this.unmounted = false;\n        this.state = {\n            siblings: []\n        };\n    }\n    componentDidMount() {\n        this.props.controller.setCallback((id, change) => {\n            setImmediate(() => this.commitChange(id, change));\n        });\n    }\n    componentDidUpdate() {\n        this.updatedSiblings.clear();\n    }\n    componentWillUnmount() {\n        this.unmounted = true;\n    }\n    commitChange(id, { change, element, updateCallback }) {\n        if (this.unmounted) {\n            return;\n        }\n        const siblings = Array.from(this.siblingsPool);\n        const index = siblings.findIndex(sibling => sibling.id === id);\n        if (change === RootControllerChanges.Remove) {\n            if (index > -1) {\n                siblings.splice(index, 1);\n            }\n            else {\n                this.invokeCallback(updateCallback);\n                return;\n            }\n        }\n        else if (change === RootControllerChanges.Update) {\n            if (index > -1) {\n                siblings.splice(index, 1, {\n                    element,\n                    id\n                });\n                this.updatedSiblings.add(id);\n            }\n            else {\n                this.invokeCallback(updateCallback);\n                return;\n            }\n        }\n        else {\n            if (index > -1) {\n                siblings.splice(index, 1);\n            }\n            siblings.push({\n                element,\n                id\n            });\n            this.updatedSiblings.add(id);\n        }\n        this.siblingsPool = siblings;\n        this.setState({\n            siblings\n        }, () => this.invokeCallback(updateCallback));\n    }\n    invokeCallback(callback) {\n        if (callback) {\n            callback();\n        }\n    }\n    renderSiblings() {\n        return this.state.siblings.map(({ id, element }) => {\n            return (<StaticContainer key={`root-sibling-${id}`} shouldUpdate={this.updatedSiblings.has(id)}>\n          {this.wrapSibling(element)}\n        </StaticContainer>);\n        });\n    }\n    wrapSibling(element) {\n        const { renderSibling } = this.props;\n        if (renderSibling) {\n            return renderSibling(element);\n        }\n        else {\n            return element;\n        }\n    }\n    render() {\n        return (<>\n        {this.props.children}\n        {this.renderSiblings()}\n      </>);\n    }\n}\n//# sourceMappingURL=RootSiblings.js.map"]},"metadata":{},"sourceType":"module"}